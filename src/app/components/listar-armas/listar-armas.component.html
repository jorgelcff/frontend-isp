<div class="container mx-auto">
  <div class="container mx-auto">
    <div class="flex justify-between p-2">
      <h3 class="text-xl font-bold mb-4">Apreensões</h3>
      <button mat-button color="primary" (click)="openModal()">
        Adicionar Apreensão
      </button>
    </div>

    <mat-expansion-panel>
      <mat-expansion-panel-header>
        <mat-panel-title> Filtros </mat-panel-title>
        <mat-panel-description>
          Clique para expandir os filtros
        </mat-panel-description>
      </mat-expansion-panel-header>
      <form
        [formGroup]="filterForm"
        (ngSubmit)="applyFilter()"
        class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-4 p-4 bg-white shadow-md rounded-lg"
      >
        <div class="mb-4">
          <label for="cisp" class="block text-sm font-medium text-gray-700"
            >CISP</label
          >
          <input
            type="text"
            id="cisp"
            formControlName="cisp"
            class="input-field mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm"
          />
        </div>
        <div class="mb-4">
          <label for="aisp" class="block text-sm font-medium text-gray-700"
            >AISP</label
          >
          <input
            type="text"
            id="aisp"
            formControlName="aisp"
            class="input-field mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm"
          />
        </div>
        <div class="mb-4">
          <label for="risp" class="block text-sm font-medium text-gray-700"
            >RISP</label
          >
          <input
            type="text"
            id="risp"
            formControlName="risp"
            class="input-field mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm"
          />
        </div>
        <div class="mb-4">
          <label for="ano" class="block text-sm font-medium text-gray-700"
            >Ano</label
          >
          <select
            id="ano"
            formControlName="ano"
            class="input-field mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm"
          >
            <option *ngFor="let year of getYears()" [value]="year">
              {{ year }}
            </option>
          </select>
        </div>
        <div class="mb-4">
          <label for="mes" class="block text-sm font-medium text-gray-700"
            >Mês</label
          >
          <select
            id="mes"
            formControlName="mes"
            class="input-field mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm"
          >
            <option *ngFor="let month of getMonths()" [value]="month">
              {{ month }}
            </option>
          </select>
        </div>
        <div
          class="col-span-1 md:col-span-2 lg:col-span-4 flex justify-end space-x-4 mb-4"
        >
          <button
            type="submit"
            class="btn-primary bg-indigo-600 text-white py-2 px-4 rounded-md shadow-sm hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500"
          >
            Aplicar Filtro
          </button>
          <button
            type="button"
            class="btn-secondary bg-gray-600 text-white py-2 px-4 rounded-md shadow-sm hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500"
            (click)="resetFilter()"
          >
            Limpar Filtro
          </button>
        </div>
      </form>
    </mat-expansion-panel>

    <!-- Skeleton Loader -->
    <div *ngIf="loading" class="animate-pulse">
      <div class="flex flex-col space-y-4">
        <div class="h-8 bg-gray-300 rounded w-full"></div>
        <div class="h-8 bg-gray-300 rounded w-full"></div>
        <div class="h-8 bg-gray-300 rounded w-full"></div>
        <div class="h-8 bg-gray-300 rounded w-full"></div>
        <div class="h-8 bg-gray-300 rounded w-full"></div>
        <div class="h-8 bg-gray-300 rounded w-full"></div>
        <div class="h-8 bg-gray-300 rounded w-full"></div>
        <div class="h-8 bg-gray-300 rounded w-full"></div>
        <div class="h-8 bg-gray-300 rounded w-full"></div>
        <div class="h-8 bg-gray-300 rounded w-full"></div>
      </div>
    </div>

    <table
      mat-table
      [dataSource]="dataSource"
      class="mat-elevation-z8"
      matSort
      *ngIf="!loading"
    >
      <ng-container matColumnDef="cisp">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>CISP</th>
        <td mat-cell *matCellDef="let element">{{ element.cisp }}</td>
      </ng-container>

      <ng-container matColumnDef="aisp">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>AISP</th>
        <td mat-cell *matCellDef="let element">{{ element.aisp }}</td>
      </ng-container>

      <ng-container matColumnDef="risp">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>RISP</th>
        <td mat-cell *matCellDef="let element">{{ element.risp }}</td>
      </ng-container>

      <ng-container matColumnDef="mes">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Mês</th>
        <td mat-cell *matCellDef="let element">{{ element.mes }}</td>
      </ng-container>

      <ng-container matColumnDef="ano">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Ano</th>
        <td mat-cell *matCellDef="let element">{{ element.ano }}</td>
      </ng-container>

      <ng-container matColumnDef="arma_fogo_total">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Total A F</th>
        <td
          mat-cell
          *matCellDef="let element"
          [matTooltip]="formatTooltipArmaFogo(element)"
        >
          {{ element.arma_fogo_total }}
        </td>
      </ng-container>

      <ng-container matColumnDef="arma_branca_total">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Total A B</th>
        <td
          mat-cell
          *matCellDef="let element"
          [matTooltip]="formatTooltipArmaBranca(element)"
        >
          {{ element.arma_branca_total }}
        </td>
      </ng-container>

      <ng-container matColumnDef="municao_total">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Total M</th>
        <td mat-cell *matCellDef="let element">{{ element.municao_total }}</td>
      </ng-container>

      <ng-container matColumnDef="simulacro_total">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Total S</th>
        <td
          mat-cell
          *matCellDef="let element"
          [matTooltip]="formatTooltipSimulacro(element)"
        >
          {{ element.simulacro_total }}
        </td>
      </ng-container>

      <ng-container matColumnDef="artefato_explosivo_total">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Total A E</th>
        <td
          mat-cell
          *matCellDef="let element"
          [matTooltip]="formatTooltipArtefato(element)"
        >
          {{ element.artefato_explosivo_total }}
        </td>
      </ng-container>

      <!-- Nova coluna para ações -->
      <ng-container matColumnDef="actions">
        <th mat-header-cell *matHeaderCellDef>Ações</th>
        <td mat-cell *matCellDef="let element">
          <button mat-icon-button color="primary" (click)="openModal(element)">
            <mat-icon>edit</mat-icon>
          </button>
          <button mat-icon-button color="warn" (click)="deleteRow(element.id)">
            <mat-icon>delete</mat-icon>
          </button>
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
    </table>

    <mat-paginator
      [length]="totalCount"
      [pageSize]="pageSize"
      [pageSizeOptions]="[10, 20, 50, 100]"
      (page)="onPageChange($event)"
    >
    </mat-paginator>
  </div>
</div>
